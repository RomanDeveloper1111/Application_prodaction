{% extends 'salary/layout/basic.html' %}
{% load static %}
{% load salary_dict %}
{% block title %} Расчетный лист {% endblock %}

{% block content %}
<p class="text-center m-0">
    <span class="text-danger m-0">Внимание</span>, участки незаполнившие табель:
        {% if errors.count > 0%}
            {% for error_dep in errors %} | {{error_dep.name}} {% endfor %}.
        {% else %}
            нет ни одного подобного участка.
        {% endif %}
</p>
<table class="table table-sm table-hover" style="width: 80% !important;">
    <thead>
     <tr class="text-center">
         <th ></th>
         <th >ФИО</th>
         <th >Должность</th>
         <th >Оклад</th>
         <th >Разряд</th>
         <th >К1</th>
         <th >Часы</th>
         <th >Пр бриг</th>
         <th >Пр нач. п.</th>
         <th >ЗП</th>
         <th >Аванс</th>
         <th >Карта</th>
         <th >Столовая</th>
         <th >Прочее</th>
         <th >Штраф</th>
         <th >Выдача</th>
     </tr>
    </thead>
    <tbody>
        {% for payroll in payrolls %}
            {% with payroll|convert as dates %}
            <tr>
                <td colspan="17" class="text-center text-uppercase fs-5" style="background: #703baa; color: white;">
                    {{payroll.department}}
                </td>
            </tr>
            {% for data in dates %}
                <tr class="selector">
                    <td class="{% get_method dates data 'norm_clocks' %}">{{forloop.counter}}</td>
                    <td>
                       <div class="input-group input-group-sm m-0 mb-0 ">
                            <input  class="form-control p-0 text-center border-0 rounded-0 worker"
                                   type="text" readonly value="{% get_method dates data 'worker' %}">
                        </div>
                    </td>
                    <td>
                        <div class="input-group input-group-sm m-0 mb-0 ">
                            <input  class="form-control p-0 text-center border-0 rounded-0 position"
                                   type="text" readonly value="{% get_method dates data 'position' %}">
                        </div>
                    </td>
                    <td>
                        <div class="input-group input-group-sm m-0 mb-0 ">
                            <input  class="form-control p-0 text-center border-0 rounded-0 salary"
                                   type="text" readonly value="{% get_method dates data 'salary' %}">
                        </div>
                    </td>
                    <td>
                        <div class="input-group input-group-sm m-0 mb-0 ">
                            <input  class="form-control p-0 text-center border-0 rounded-0 degree"
                                   type="text" readonly value="{% get_method dates data 'degree' %}">
                        </div>
                    </td>
                    <td>
                        <div class="input-group input-group-sm m-0 mb-0 ">
                            <input class="form-control p-0 text-center border-0 rounded-0 coefficient"
                                   type="text" value="{% get_method dates data 'coefficient' %}">
                        </div>
                    </td>
                    <td>
                        <div class="input-group input-group-sm m-0 mb-0 ">
                            <input  class="form-control p-0 text-center border-0 rounded-0 sumclocks"
                                   type="text" readonly value="{% get_method dates data 'sumclocks' %}">
                        </div>
                    </td>
                    <td>
                        <div class="input-group input-group-sm m-0 mb-0 ">
                            <input class="form-control p-0 text-center border-0 rounded-0 extra_from_foreman"
                                   type="float" value="{% get_method dates data 'extra_from_foreman' %}">
                        </div>
                    </td>
                    <td>
                        <div class="input-group input-group-sm m-0 mb-0 ">
                            <input class="form-control p-0 text-center border-0 rounded-0 extra_from_director"
                                   type="float" value="{% get_method dates data 'extra_from_director' %}">
                        </div>
                    </td>
                    <td>
                        <div class="input-group input-group-sm m-0 mb-0 ">
                            <input  class="form-control p-0 text-center border-0 rounded-0 wage"
                                   type="text" readonly value="0.00">
                        </div>
                    </td>
                    <td>
                        <div class="input-group input-group-sm m-0 mb-0 ">
                            <input class="form-control p-0 text-center border-0 rounded-0 prepayment"
                                   type="float" value="{% get_method dates data 'prepayment' %}">
                        </div>
                    </td>
                    <td id="1"  >
                        <div class="input-group input-group-sm m-0 mb-0 ">
                            <input class="form-control p-0 text-center border-0 rounded-0 card"
                                   type="float" value="{% get_method dates data 'card' %}">
                        </div>
                    </td>
                    <td>
                        <div class="input-group input-group-sm m-0 mb-0 ">
                            <input class="form-control p-0 text-center border-0 rounded-0 breakfast"
                                   type="float" value="{% get_method dates data 'breakfast' %}">
                        </div>
                    </td>
                    <td>
                        <div class="input-group input-group-sm m-0 mb-0 ">
                            <input class="form-control p-0 text-center border-0 rounded-0 other"
                                   type="float" value="{% get_method dates data 'other' %}">
                        </div>
                    </td>


                    <td>
                        <div class="input-group input-group-sm m-0 mb-0 ">
                            <input readonly class="form-control p-0 text-center border-0 rounded-0 fines"
                                   type="float" value="{% get_method dates data 'fines' %}">
                        </div>
                    </td>

                    <td>
                        <div class="input-group input-group-sm m-0 mb-0 ">
                            <input readonly class="form-control p-0 text-center border-0 rounded-0 result"
                                   type="float" value="0.00">
                        </div>
                    </td>


                </tr>
            {% endfor %}
            {% endwith %}
        {% endfor %}
    </tbody>
</table>





</div>

<style>
    th {
        font-size: 12px;
        font-weight: bold !important;
        padding: 4px 0px !important;
        text-transform: uppercase !important;
    }
    td{
        padding: 1px 2px !important;
    }
    input:focus{
        border: 1px solid green !important;
    }
    .input-group {
        width: fit-content;
    }
    .form-control{
         background: white !important;
    }
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script type="text/javascript">

$(document).ready(function(){

    function analysis_salary(parent){
        salary = Number(parent.children[3].children[0].children[0].value);
        degree = Number(parent.children[4].children[0].children[0].value);
        coefficient = Number(parent.children[5].children[0].children[0].value);
        sumclocks = Number(parent.children[6].children[0].children[0].value);
        extra_from_foreman = Number(parent.children[7].children[0].children[0].value);
        extra_from_director = Number(parent.children[8].children[0].children[0].value);
        prepayment = Number(parent.children[10].children[0].children[0].value);
        cart = Number(parent.children[11].children[0].children[0].value);
        kitchen = Number(parent.children[12].children[0].children[0].value);
        other = Number(parent.children[13].children[0].children[0].value);
        fines = Number(parent.children[14].children[0].children[0].value);


        parent.children[9].children[0].children[0].value =
                Number((salary/176*sumclocks)*1*coefficient+extra_from_foreman+extra_from_director).toFixed(2);
        parent.children[15].children[0].children[0].value =
                Number(parent.children[9].children[0].children[0].value - prepayment - cart - kitchen - other - fines).toFixed(2);
    }

    all_selectors = document.getElementsByClassName('selector');
    for (var i=0; i < all_selectors.length; i++){
        analysis_salary(all_selectors[i]);
    }



    $('input.form-control').keyup(function(event){
        if(event.keyCode > 47 && event.keyCode <58 || event.keyCode > 95 && event.keyCode <106 || event.keyCode == 13){
            parent = this.parentElement.parentNode.parentNode;
             analysis_salary(parent);
        }
    });
});





</script>
{% endblock %}